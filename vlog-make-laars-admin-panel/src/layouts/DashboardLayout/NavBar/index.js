/* eslint-disable no-use-before-define */
import React, { useEffect } from 'react';
import { useLocation, matchPath } from 'react-router-dom';
import { Link as RouterLink } from 'react-router-dom';
import PerfectScrollbar from 'react-perfect-scrollbar';
import PropTypes from 'prop-types';
import {
  Box,
  Divider,
  Drawer,
  Hidden,
  List,
  ListSubheader,
  makeStyles
} from '@material-ui/core';

import Logo from 'src/components/Logo';
import useAuth from 'src/hooks/useAuth';
import NavItem from './NavItem';

const sections = [
  {
    items: [
      {
        title: 'Dashboard',
        href: '/admin/dashboard',
        icon: (
          <svg
            className="hello"
            width="16"
            height="17"
            viewBox="0 0 18 18"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M3.16797 0.666504H14.8346C16.2513 0.666504 17.3346 1.74984 17.3346 3.1665V14.8332C17.3346 16.2498 16.2513 17.3332 14.8346 17.3332H3.16797C1.7513 17.3332 0.667969 16.2498 0.667969 14.8332V3.1665C0.667969 1.74984 1.7513 0.666504 3.16797 0.666504ZM14.8346 2.33317H3.16797C2.66797 2.33317 2.33464 2.6665 2.33464 3.1665V5.6665H15.668V3.1665C15.668 2.6665 15.3346 2.33317 14.8346 2.33317ZM2.33464 14.8332V7.33317H5.66797V15.6665H3.16797C2.66797 15.6665 2.33464 15.3332 2.33464 14.8332ZM7.33464 15.6665H14.8346C15.3346 15.6665 15.668 15.3332 15.668 14.8332V7.33317H7.33464V15.6665Z"
              fill="#24272A"
            />
          </svg>
        )
      },
      {
        title: 'Huizen',
        href: '/admin/huizen',
        icon: (
          <svg
            className="hello"
            width="17"
            height="18"
            viewBox="0 0 23 21"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M21.7015 10.8482C21.5223 10.8482 21.3432 10.7798 21.2065 10.6431L20.6515 10.088V18.9874C20.6515 20.0971 19.7486 21 18.6388 21H14.001H8.4006H3.76278C2.65303 21 1.75014 20.0972 1.75014 18.9874V10.0881L1.19506 10.6431C0.921691 10.9166 0.478429 10.9166 0.20506 10.6431C-0.0683532 10.3698 -0.0683532 9.92651 0.20506 9.65314L8.91139 0.946772C10.1738 -0.315591 12.2278 -0.315591 13.4901 0.946772L22.1965 9.6531C22.4699 9.92651 22.4699 10.3697 22.1965 10.6431C22.0598 10.7798 21.8807 10.8482 21.7015 10.8482ZM9.10065 19.5999H13.3009V14.087C13.3009 13.6528 12.9476 13.2995 12.5134 13.2995H9.8882C9.45395 13.2995 9.10065 13.6528 9.10065 14.087V19.5999ZM14.701 19.5999V14.087C14.701 12.8808 13.7197 11.8994 12.5134 11.8994H9.8882C8.68193 11.8994 7.70055 12.8808 7.70055 14.087V19.5999H3.76278C3.425 19.5999 3.15023 19.3252 3.15023 18.9874V8.68797L9.90139 1.93682C10.6179 1.22032 11.7837 1.22032 12.5001 1.93682L19.2514 8.68796V18.9874C19.2514 19.3252 18.9766 19.5999 18.6388 19.5999H14.701Z"
              fill="#24272A"
            />
          </svg>
        )
      },
      {
        title: 'Aanvragen',
        href: '/admin/aanvragen',
        icon: (
          <svg
            className="hello"
            width="16"
            height="17"
            viewBox="0 0 16 17"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10.8203 7.30469C10.8203 6.93793 10.523 6.64062 10.1563 6.64062H3.31641C2.94964 6.64062 2.65234 6.93793 2.65234 7.30469C2.65234 7.67145 2.94964 7.96875 3.31641 7.96875H10.1563C10.523 7.96875 10.8203 7.67145 10.8203 7.30469Z"
              fill="#24272A"
            />
            <path
              d="M3.31641 9.29688C2.94964 9.29688 2.65234 9.59418 2.65234 9.96094C2.65234 10.3277 2.94964 10.625 3.31641 10.625H7.47048C7.83724 10.625 8.13455 10.3277 8.13455 9.96094C8.13455 9.59418 7.83724 9.29688 7.47048 9.29688H3.31641Z"
              fill="#24272A"
            />
            <path
              d="M4.87717 15.6719H2.65625C1.92392 15.6719 1.32812 15.0761 1.32812 14.3438V2.65625C1.32812 1.92392 1.92392 1.32812 2.65625 1.32812H10.8205C11.5529 1.32812 12.1487 1.92392 12.1487 2.65625V6.74023C12.1487 7.107 12.446 7.4043 12.8127 7.4043C13.1795 7.4043 13.4768 7.107 13.4768 6.74023V2.65625C13.4768 1.19159 12.2852 0 10.8205 0H2.65625C1.19159 0 0 1.19159 0 2.65625V14.3438C0 15.8084 1.19159 17 2.65625 17H4.87717C5.24394 17 5.54124 16.7027 5.54124 16.3359C5.54124 15.9692 5.24394 15.6719 4.87717 15.6719Z"
              fill="#24272A"
            />
            <path
              d="M14.6548 9.61487C13.878 8.83812 12.6142 8.83808 11.8379 9.61434L8.19215 13.2521C8.11472 13.3293 8.05761 13.4245 8.0258 13.5292L7.23181 16.1431C7.16142 16.3748 7.22275 16.6265 7.39188 16.7998C7.51859 16.9297 7.69071 17.0002 7.86725 17.0002C7.92632 17.0002 7.98595 16.9923 8.04449 16.976L10.7248 16.2336C10.8351 16.203 10.9357 16.1445 11.0167 16.0636L14.6548 12.4323C15.4316 11.6555 15.4316 10.3917 14.6548 9.61487ZM10.202 15.0003L8.85355 15.3738L9.24817 14.0746L11.7082 11.6201L12.6475 12.5594L10.202 15.0003ZM13.7162 11.4928L13.5875 11.6212L12.6484 10.682L12.7766 10.5541C13.0355 10.2951 13.4568 10.2951 13.7157 10.5541C13.9746 10.813 13.9746 11.2343 13.7162 11.4928Z"
              fill="#24272A"
            />
            <path
              d="M10.1563 3.98438H3.31641C2.94964 3.98438 2.65234 4.28168 2.65234 4.64844C2.65234 5.0152 2.94964 5.3125 3.31641 5.3125H10.1563C10.523 5.3125 10.8203 5.0152 10.8203 4.64844C10.8203 4.28168 10.523 3.98438 10.1563 3.98438Z"
              fill="#24272A"
            />
          </svg>
        )
      },
      {
        title: 'Klanten',
        href: '/admin/klanten',
        icon: (
          <svg
            className="hello"
            width="16"
            height="17"
            viewBox="0 0 20 18"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M16.6654 3.99984H14.1654V3.1665C14.1654 1.74984 13.082 0.666504 11.6654 0.666504H8.33203C6.91536 0.666504 5.83203 1.74984 5.83203 3.1665V3.99984H3.33203C1.91536 3.99984 0.832031 5.08317 0.832031 6.49984V14.8332C0.832031 16.2498 1.91536 17.3332 3.33203 17.3332H16.6654C18.082 17.3332 19.1654 16.2498 19.1654 14.8332V6.49984C19.1654 5.08317 18.082 3.99984 16.6654 3.99984ZM7.4987 3.1665C7.4987 2.6665 7.83203 2.33317 8.33203 2.33317H11.6654C12.1654 2.33317 12.4987 2.6665 12.4987 3.1665V3.99984H7.4987V3.1665ZM12.4987 15.6665V5.6665H7.4987V15.6665H12.4987ZM2.4987 14.8332V6.49984C2.4987 5.99984 2.83203 5.6665 3.33203 5.6665H5.83203V15.6665H3.33203C2.83203 15.6665 2.4987 15.3332 2.4987 14.8332ZM16.6654 15.6665C17.1654 15.6665 17.4987 15.3332 17.4987 14.8332V6.49984C17.4987 5.99984 17.1654 5.6665 16.6654 5.6665H14.1654V15.6665H16.6654Z"
              fill="#24272A"
            />
          </svg>
        )
      },
      {
        title: 'Gebruikers',
        href: '/admin/gebruikers',
        icon: (
          <svg
            className="hello"
            width="16"
            height="17"
            viewBox="0 0 20 18"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M3.34662 4.83317C3.34662 2.49984 5.18726 0.666504 7.5299 0.666504C9.87253 0.666504 11.7132 2.49984 11.7132 4.83317C11.7132 7.1665 9.87253 8.99984 7.5299 8.99984C5.18726 8.99984 3.34662 7.1665 3.34662 4.83317ZM15.0598 14.8332V16.4998C15.0598 16.9998 14.7251 17.3332 14.2231 17.3332C13.7211 17.3332 13.3865 16.9998 13.3865 16.4998V14.8332C13.3865 13.4165 12.2988 12.3332 10.8765 12.3332H4.18328C2.76096 12.3332 1.67331 13.4165 1.67331 14.8332V16.4998C1.67331 16.9998 1.33865 17.3332 0.836655 17.3332C0.334662 17.3332 0 16.9998 0 16.4998V14.8332C0 12.4998 1.84064 10.6665 4.18328 10.6665H10.8765C13.2192 10.6665 15.0598 12.4998 15.0598 14.8332ZM7.5299 7.33317C6.10758 7.33317 5.01993 6.24984 5.01993 4.83317C5.01993 3.4165 6.10758 2.33317 7.5299 2.33317C8.95221 2.33317 10.0399 3.4165 10.0399 4.83317C10.0399 6.24984 8.95221 7.33317 7.5299 7.33317ZM16.9004 10.8332C16.4821 10.7498 15.9801 10.9998 15.8964 11.4165C15.8128 11.8332 16.0638 12.3332 16.4821 12.4165C17.5698 12.6665 18.3227 13.6665 18.3227 14.8332V16.4998C18.3227 16.9998 18.6574 17.3332 19.1594 17.3332C19.6614 17.3332 19.9961 16.9998 19.9961 16.4998V14.8332C20.0797 12.9165 18.8247 11.2498 16.9004 10.8332ZM12.5498 1.4165C12.7172 0.916504 13.1355 0.666504 13.5538 0.833171C15.8128 1.33317 17.1514 3.6665 16.5658 5.99984C16.2311 7.49984 15.0598 8.58317 13.5538 8.99984H13.3865C12.9682 8.99984 12.6335 8.74984 12.5498 8.33317C12.3825 7.9165 12.7172 7.4165 13.1355 7.33317C14.0558 7.08317 14.7251 6.4165 14.9761 5.49984C15.3108 4.08317 14.4741 2.74984 13.1355 2.4165C12.7172 2.33317 12.4662 1.83317 12.5498 1.4165Z"
              fill="#24272A"
            />
          </svg>
        )
      },
      {
        title: 'Facturen',
        href: '/admin/facturen',
        icon: (
          <svg
            className="hello"
            width="16"
            height="17"
            viewBox="0 0 23 21"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M18.2265 19.4458H4.55469V20.9994H18.2265V19.4458Z"
              fill="#24272A"
            />
            <path
              d="M13.8484 6.93945H9.05808C8.62902 6.93945 8.28125 7.28722 8.28125 7.71628C8.28125 8.14534 8.62902 8.49311 9.05808 8.49311H13.8484C14.2774 8.49311 14.6252 8.14534 14.6252 7.71628C14.6252 7.28722 14.2774 6.93945 13.8484 6.93945Z"
              fill="#24272A"
            />
            <path
              d="M17.4735 10.5649H9.05808C8.62902 10.5649 8.28125 10.9127 8.28125 11.3418C8.28125 11.7708 8.62902 12.1186 9.05808 12.1186H17.4735C17.9026 12.1186 18.2503 11.7708 18.2503 11.3418C18.2503 10.9127 17.9025 10.5649 17.4735 10.5649Z"
              fill="#24272A"
            />
            <path
              d="M21.6519 0.0946068C21.373 -0.030724 21.047 0.0187563 20.8181 0.220969L18.6428 2.14538L16.4649 0.1979C16.1699 -0.0659668 15.7241 -0.0659668 15.4291 0.1979L13.2541 2.14302L11.0787 0.1979C10.7838 -0.0659668 10.3382 -0.0659668 10.0432 0.1979L7.86532 2.14538L5.69001 0.220969C5.46138 0.0190039 5.13512 -0.0304764 4.85623 0.0946068C4.57763 0.220185 4.39845 0.497258 4.39845 0.802806V14.63H1.7573C1.32823 14.63 0.980469 14.9777 0.980469 15.4068V17.297C0.980469 19.3387 2.64154 20.9998 4.68324 20.9998V19.4462C3.4981 19.4462 2.53408 18.4819 2.53408 17.297V16.1836H14.7041V17.297C14.7041 19.3387 16.3652 20.9998 18.4068 20.9998C20.4485 20.9998 22.1096 19.3388 22.1096 17.2971V0.802765C22.1097 0.497217 21.9305 0.220185 21.6519 0.0946068ZM20.556 17.297C20.556 18.4819 19.5918 19.4462 18.4069 19.4462C17.222 19.4462 16.2577 18.4819 16.2577 17.297V15.4068C16.2577 14.9777 15.91 14.63 15.4809 14.63H5.95206V2.52702L7.35368 3.76708C7.64887 4.0281 8.09267 4.02678 8.38604 3.76424L10.5611 1.81911L12.7362 3.76399C13.0311 4.02785 13.477 4.02785 13.7719 3.76399L15.9472 1.81886L18.1223 3.76399C18.4159 4.02653 18.8598 4.02757 19.1547 3.76684L20.556 2.52706V17.297Z"
              fill="#24272A"
            />
          </svg>
        )
      },
      {
        title: 'Instellingen',
        href: '/admin/instellingen',
        icon: (
          <svg
            className="hello"
            width="16"
            height="17"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10.6276 20H9.37238C8.35719 20 7.53121 19.1741 7.53121 18.1589V17.7342C7.09961 17.5963 6.68027 17.4223 6.27742 17.2138L5.97648 17.5147C5.24762 18.2445 4.08008 18.2231 3.37238 17.5145L2.48523 16.6273C1.77629 15.9192 1.7559 14.752 2.48547 14.0232L2.78617 13.7225C2.5777 13.3197 2.40367 12.9004 2.26574 12.4688H1.84113C0.825976 12.4688 0 11.6428 0 10.6276V9.37238C0 8.35719 0.825976 7.53125 1.84117 7.53125H2.26578C2.40371 7.09961 2.57773 6.68031 2.78621 6.27746L2.48527 5.97656C1.75613 5.2482 1.77625 4.08094 2.48551 3.37246L3.37273 2.48527C4.08207 1.77496 5.24934 1.75723 5.9768 2.48551L6.27746 2.78617C6.68031 2.57773 7.09965 2.40367 7.53125 2.26574V1.84113C7.53125 0.825937 8.35719 0 9.37242 0H10.6276C11.6428 0 12.4688 0.825937 12.4688 1.84113V2.26578C12.9004 2.40367 13.3197 2.57773 13.7225 2.78621L14.0235 2.48527C14.7523 1.75551 15.9199 1.77691 16.6276 2.48555L17.5147 3.37266C18.2237 4.08082 18.2441 5.24797 17.5145 5.97676L17.2138 6.27746C17.4223 6.68031 17.5963 7.09957 17.7342 7.53125H18.1588C19.174 7.53125 20 8.35719 20 9.37238V10.6276C20 11.6428 19.174 12.4688 18.1588 12.4688H17.7342C17.5963 12.9004 17.4223 13.3197 17.2138 13.7225L17.5147 14.0235C18.2439 14.7518 18.2237 15.9191 17.5145 16.6276L16.6273 17.5148C15.9179 18.2251 14.7507 18.2428 14.0232 17.5145L13.7225 17.2139C13.3197 17.4223 12.9004 17.5964 12.4688 17.7343V18.1589C12.4688 19.1741 11.6428 20 10.6276 20ZM6.47332 15.9832C7.03297 16.3142 7.63531 16.5642 8.26359 16.7264C8.52234 16.7931 8.70312 17.0265 8.70312 17.2937V18.1589C8.70312 18.5279 9.0034 18.8281 9.37242 18.8281H10.6276C10.9966 18.8281 11.2969 18.5279 11.2969 18.1589V17.2937C11.2969 17.0265 11.4777 16.7931 11.7364 16.7264C12.3647 16.5642 12.9671 16.3142 13.5267 15.9832C13.757 15.847 14.0502 15.8841 14.2393 16.0732L14.8521 16.6861C15.1164 16.9506 15.5407 16.9445 15.7984 16.6864L16.6862 15.7986C16.9433 15.5418 16.9519 15.1175 16.6864 14.8523L16.0733 14.2393C15.8842 14.0501 15.8471 13.7569 15.9833 13.5267C16.3143 12.9671 16.5643 12.3647 16.7264 11.7364C16.7932 11.4777 17.0266 11.2969 17.2938 11.2969H18.1589C18.5279 11.2969 18.8282 10.9967 18.8282 10.6277V9.37242C18.8282 9.0034 18.5279 8.70316 18.1589 8.70316H17.2938C17.0265 8.70316 16.7932 8.52238 16.7264 8.26367C16.5643 7.63535 16.3142 7.03301 15.9833 6.4734C15.8471 6.24316 15.8842 5.94996 16.0733 5.76082L16.6862 5.14797C16.9511 4.88336 16.9442 4.45914 16.6864 4.20168L15.7987 3.31398C15.5414 3.05633 15.117 3.04879 14.8524 3.31375L14.2394 3.92684C14.0502 4.11602 13.757 4.15305 13.5268 4.01688C12.9671 3.6859 12.3648 3.43586 11.7365 3.27371C11.4777 3.20695 11.297 2.97359 11.297 2.70637V1.84113C11.297 1.47211 10.9967 1.17188 10.6277 1.17188H9.37246C9.00344 1.17188 8.70316 1.47211 8.70316 1.84113V2.70629C8.70316 2.97352 8.52238 3.20688 8.26363 3.27363C7.63535 3.43578 7.03301 3.68582 6.47336 4.0168C6.24305 4.15293 5.94988 4.1159 5.76074 3.92676L5.14793 3.31391C4.88371 3.04938 4.45938 3.05551 4.20168 3.31363L3.31391 4.20137C3.0568 4.45816 3.0482 4.8825 3.31367 5.14766L3.92676 5.76074C4.1159 5.94988 4.15293 6.24309 4.0168 6.47332C3.68582 7.03293 3.43582 7.63527 3.27367 8.26359C3.20688 8.52234 2.97352 8.70309 2.70633 8.70309H1.84117C1.47215 8.70312 1.17188 9.00336 1.17188 9.37238V10.6276C1.17188 10.9966 1.47215 11.2969 1.84117 11.2969H2.70629C2.97352 11.2969 3.20684 11.4777 3.27363 11.7364C3.43578 12.3647 3.68582 12.967 4.01676 13.5266C4.15289 13.7569 4.11586 14.0501 3.92672 14.2392L3.31387 14.8521C3.04895 15.1167 3.05586 15.5409 3.31363 15.7984L4.20133 16.6861C4.45863 16.9437 4.88301 16.9513 5.14762 16.6863L5.76066 16.0732C5.90004 15.9339 6.19 15.8156 6.47332 15.9832Z"
              fill="black"
            />
            <path
              d="M10 14.3516C7.60051 14.3516 5.64844 12.3995 5.64844 10C5.64844 7.60055 7.60051 5.64844 10 5.64844C12.3995 5.64844 14.3516 7.60055 14.3516 10C14.3516 12.3995 12.3995 14.3516 10 14.3516ZM10 6.82031C8.24668 6.82031 6.82031 8.24672 6.82031 10C6.82031 11.7533 8.24672 13.1797 10 13.1797C11.7533 13.1797 13.1797 11.7533 13.1797 10C13.1797 8.24672 11.7533 6.82031 10 6.82031Z"
              fill="black"
            />
          </svg>
        )
      }
    ]
  }
];

function renderNavItems({ items, pathname, depth = 0 }) {
  return (
    <List disablePadding>
      {items.reduce(
        (acc, item) => reduceChildRoutes({ acc, item, pathname, depth }),
        []
      )}
    </List>
  );
}

function reduceChildRoutes({ acc, pathname, item, depth }) {
  const key = item.title + depth + '-' + Math.floor(Math.random() * 10 + 1);
  if (item.items) {
    const open = matchPath(pathname, {
      path: item.href,
      exact: false
    });

    acc.push(
      <NavItem
        depth={depth}
        icon={item.icon}
        info={item.info}
        key={key}
        open={Boolean(open)}
        title={item.title}
      >
        {renderNavItems({
          depth: depth + 1,
          pathname,
          items: item.items
        })}
      </NavItem>
    );
  } else {
    acc.push(
      <NavItem
        depth={depth}
        href={item.href}
        icon={item.icon}
        info={item.info}
        key={key}
        title={item.title}
      />
    );
  }

  return acc;
}

const useStyles = makeStyles(() => ({
  subHeader: {
    color: '#24272A'
  },
  sidebarWrapper: {
    background: 'white',
    boxShadow:
      '0px 0px 0px rgba(63, 63, 68, 0.05), 0px 1px 2px rgba(63, 63, 68, 0.15)'
  },
  mobileDrawer: {
    width: 256
  },
  desktopDrawer: {
    width: 256,
    top: 64,
    height: 'calc(100% - 64px)'
  },
  avatar: {
    cursor: 'pointer',
    width: 64,
    height: 64
  }
}));

const NavBar = ({ onMobileClose, openMobile }) => {
  const classes = useStyles();
  const location = useLocation();
  const { user } = useAuth();

  useEffect(() => {
    if (openMobile && onMobileClose) {
      onMobileClose();
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [location.pathname]);

  const content = (
    <Box
      className={classes.sidebarWrapper}
      height="100%"
      display="flex"
      flexDirection="column"
    >
      <PerfectScrollbar options={{ suppressScrollX: true }}>
        <Hidden lgUp>
          <Box p={2} display="flex" justifyContent="center">
            <RouterLink to="/">
              <Logo />
            </RouterLink>
          </Box>
        </Hidden>
        <Divider />
        <Box p={2}>
          {sections.map(section => (
            <List
              key={`${Math.floor(Math.random() * 10000 + 1)}`}
              subheader={
                <ListSubheader
                  className={classes.subHeader}
                  disableGutters
                  disableSticky
                >
                  {section.subheader}
                </ListSubheader>
              }
            >
              {renderNavItems({
                items: section.items,
                pathname: location.pathname
              })}
            </List>
          ))}
        </Box>
      </PerfectScrollbar>
    </Box>
  );

  return (
    <>
      <Hidden lgUp>
        <Drawer
          anchor="left"
          classes={{ paper: classes.mobileDrawer }}
          onClose={onMobileClose}
          open={openMobile}
          variant="temporary"
        >
          {content}
        </Drawer>
      </Hidden>
      <Hidden mdDown>
        <Drawer
          anchor="left"
          classes={{ paper: classes.desktopDrawer }}
          open
          variant="persistent"
        >
          {content}
        </Drawer>
      </Hidden>
    </>
  );
};

NavBar.propTypes = {
  onMobileClose: PropTypes.func,
  openMobile: PropTypes.bool
};

export default NavBar;
